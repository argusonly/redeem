<!DOCTYPE html>
<html>
<head lang="en">
<meta charset="UTF-8">
<title>太古里</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,height=device-height,inital-scale=1.0,maximum-scale=1.0,user-scalable=no;">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<link media="all" type="text/css" rel="stylesheet" href="../assets/css/public-style.css">
<link media="all" type="text/css" rel="stylesheet" href="../assets/css/animate.min.css">
<link media="all" type="text/css" rel="stylesheet" href="../assets/css/side.css">
<link media="all" type="text/css" rel="stylesheet" href="../assets/css/tc.css">
<link media="all" type="text/css" rel="stylesheet" href="../assets/css/entry.css">
<style>
.xg .suo img {
	width: 20%;
	-ms-transform:rotate(45deg); 	/* IE 9 */
	-moz-transform:rotate(45deg); 	/* Firefox */
	-webkit-transform:rotate(45deg); /* Safari 和 Chrome */
	-o-transform:rotate(45deg); 	/* Opera */
}
.mm img {
	width: 0.16rem;
	margin: 0.28rem 0.35rem 0 0.1rem;
	-ms-transform:rotate(45deg); 	/* IE 9 */
	-moz-transform:rotate(45deg); 	/* Firefox */
	-webkit-transform:rotate(45deg); /* Safari 和 Chrome */
	-o-transform:rotate(45deg); 	/* Opera */
}
</style>
</head>
<body>

<!-- 加载 -->
<div id="jiaZai"> <img src="../assets/image/loadbg.png"> </div>

<!-- 内容 --> 
<!-- 内容 -->
<div id="main">
  <div class="title">
    <div> <img src="../assets/image/dhlp2.png"> 礼品兑换 - <img src="../assets/image/qian.png"> 消费录入 </div>
    <div>Gift Redemption - Purchase Entry</div>
  </div>
  <div class="content">
    <div class="content_1">
      <div class="act">
        <p><img src="../assets/image/qian.png">消费信息录入 / Purchase Entry</p>
      </div>
    </div>
    <div class="content_2"> <a href="javascript:void (0)" class="xinZeng">增加记录 / Add record</a>
      <div>
        <div class="dp">
          <p>店铺名称 / Merchant</p>
          <input type="text" placeholder="店铺名称" class="store-name"/>
          <input type="hidden" placeholder="店铺code" class="store-code"/>
          <a href="javascript:void (0)" class="search"><img src="../assets/image/search.png"></a> </div>
        <div>
          <p>流水号 / Serial Number</p>
          <input type="text" placeholder="流水号" class="serial-num"/>
        </div>
        <div>
          <p>消费金额 / Amount</p>
          <input type="number" placeholder="0.00" class="amount" />
        </div>
      </div>
    </div>
  </div>
  <div class="anNiu"> <a href="search.html" class="sy"> 上一页<br/>
    Previous </a> <a href="javascript:void (0)" class="xy
                "> 下一页<br/>
    Next </a> 
    
    <!--<a href="javascript:void (0)" class="bc">--> 
    <!--保存<br/>--> 
    <!--Save--> 
    <!--</a>--> 
  </div>
</div>
<div class="xuanZe">
  <div> <a href="javascript:void (0)" class="xuanZe_gb"><img src="../assets/image/gb.png"></a>
    <p><img src="../assets/image/xuanZe.png"> 请选择商户 / Find merchant</p>
    <div class="hangHu"> </div>
  </div>
</div>
<div class="gn">
  <div class="dj">
    <div> <img src="../assets/image/gn1.png" class="xs" alt=""> <img src="../assets/image/gn2.png" class="yc" alt=""> </div>
    <div><img src="../assets/image/gn2.png"></div>
  </div>
  <div class="nr">
    <div>礼品兑换系统</div>
    <p class="lp"><a href="search.html"><img src="../assets/image/dhlp.png">礼品兑换</a></p>
    <p class="mm"><img src="../assets/image/bi.png" class="bi" alt="">修改密码</p>
    <p class="tuichu"><img src="../assets/image/dl2.png">退出登录</p>
    <div class="renWu"> <img src="../assets/image/renWu.png">
      <p>18602897807</p>
      <p class="time"></p>
    </div>
  </div>
</div>
<div class="xg">
  <div> <a href="javascript:void (0)" class="gb"><img src="../assets/image/gb.png"></a>
    <div class="xg_content">
      <div class="suo"> <img src="../assets/image/bi.png"> </div>
      <div class="xg_info">
        <p class="title">修改密码</p>
        <input type="password" id="oldPassword" placeholder="旧密码"/>
        <input type="password" id="newPassword" placeholder="新密码"/>
        <input type="password" id="rePassword" placeholder="再次输入新密码"/>
        <a href="javascript:void (0)" class="cs mima">确认修改密码</a> </div>
    </div>
  </div>
</div>
</body>
<!-- Javascripts -->
<script src="../assets/js/remJs.js"></script>
<script src="../assets/js/jquery-1.8.0.min.js"></script>
<script src="../assets/js/plugins/layer/layer.js"></script>
<script>
    window.onload = function(){
        $('#jiaZai').hide();
        $('#main').show();
    }
     $(function(){
             var dt = new Date();
             var m=new Array("Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Spt ","Oct ","Nov ","Dec ");
             var mn=dt.getMonth();
             var dn=dt.getDate();
             $('.time').html(m[mn]+"&nbsp;"+dn+'，'+dt.getFullYear());
     //右侧功能栏隐藏显示
             $('.xs').click(function(){
                 $(this).hide();
                 $('.yc').show();
                 $('.gn').css('WebkitAnimation','yd2 0.4s forwards');
             });
             $('.yc').click(function(){
                 $(this).hide();
                 $('.xs').show();
                 $('.gn').css('WebkitAnimation','yd1 0.4s forwards');
             });


             //侧栏操作
             $('.lp').click(function(){
                 $('.yc').hide();
                 $('.xs').show();
                 $('.gn').css('WebkitAnimation','yd1 0.4s forwards');
             });
             $('.mm').click(function(){
                 $('.yc').hide();
                 $('.xs').show();
                 $('.gn').css('WebkitAnimation','yd1 0.4s forwards');
                 $('.xg').fadeIn(200);
             });
             $('.gb').click(function(){$('.xg').fadeOut(200);});

             $('.tuichu').on('click',function(){
                $.ajax({
                    url: "../user/logout",
                    type: "get",
                    data: {},
                    dataType:"json",
                    success: function(ret) {
                        layer.closeAll();
                        if (ret.status == 1) {
                            var i=3;
                            setInterval(function(){
                                layer.msg("正在退出 ("+i+")", {
                                  time: 1000
                                });
                                if(i==0) location.href = '../user/login';
                                  i--;
                            },1000);
                        }else{
                            layer.msg(ret.message, {
                              time: 2000
                            });
                        }
                    }
                })
             })

             $('.cs').on('click',function(){
                if(!$(this).hasClass('mima'))return false;
                 var oldpass = $('#oldPassword').val();
                 var newpass = $('#newPassword').val();
                 var repass = $('#rePassword').val();
                 if(newpass!=repass){
                    layer.msg('两次输入的新密码不相同！', {
                       time: 2000
                    });
                    return false;
                 }
                 if(newpass==oldpass){
                     layer.msg('输入的新旧密码相同！', {
                        time: 2000
                     });
                     return false;
                 }
                 $.ajax({
                     url: "../user/password",
                     type: "post",
                     data: {oldpass:oldpass,newpass:newpass,repass:repass},
                     dataType:"json",
                     success: function(ret) {
                         layer.closeAll();
                         if (ret.status == 1) {
                             $('#oldPassword').val('');
                             $('#newPassword').val('');
                             $('#rePassword').val('');
                            $('.xg .gb').click();
                         }
                         layer.msg(ret.message, {
                           time: 2000
                         });
                     }
                 })
              })
     });
</script>
<script>
    window.onload=function(){
        $('#jiaZai').hide();
        $('#main').show();

        var dt = new Date();
        var m=new Array("Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Spt ","Oct ","Nov ","Dec ");
        var mn=dt.getMonth();
        var dn=dt.getDate();
        $('.time').html(m[mn]+"&nbsp;"+dn+'，'+dt.getFullYear());

        //右侧功能栏隐藏显示
        $('.xs').click(function(){
            $(this).hide();
            $('.yc').show();
            $('.gn').css('WebkitAnimation','yd2 0.4s forwards');
        });
        $('.yc').click(function(){
            $(this).hide();
            $('.xs').show();
            $('.gn').css('WebkitAnimation','yd1 0.4s forwards');
        });
		//上一页
		


        //侧栏操作
        $('.lp').click(function(){
            $('.yc').hide();
            $('.xs').show();
            $('.gn').css('WebkitAnimation','yd1 0.4s forwards');
        });
        $('.mm').click(function(){
            $('.yc').hide();
            $('.xs').show();
            $('.gn').css('WebkitAnimation','yd1 0.4s forwards');
            $('.xg').fadeIn(200);
        });
        $('.gb').click(function(){$('.xg').fadeOut(200);});


        //顾客信息记录选择
        $('.content_1>div').click(function(){
            if(!$(this).hasClass('act')){
                $('.content_1 .act').removeClass('act');
                $(this).addClass('act');
                $('.content_2>div').hide();
                $('.content_2>div:eq('+$(this).index()+')').show();
            }
        });

        //新增
        $('.xinZeng').click(function(){
            $('.content_2').append(
                '<div>'+
                    '<div class="dp">'+
                        '<p>店铺名称 / Merchant</p>'+
                        '<input type="text" placeholder="店铺名称" class="store-name"/><input type="hidden" placeholder="店铺code" class="store-code"/>'+
                        '<a href="javascript:void (0)" class="search"><img src="../assets/image/search.png"/></a>'+
                    '</div>'+
                    '<div>'+
                        '<p>流水号 / Serial Number</p>'+
                        '<input type="text" placeholder="流水号" class="serial-num"/>'+
                    '</div>'+
                    '<div>'+
                        '<p>消费金额 / Amount</p>'+
                        '<input type="number" placeholder="0.00" class="amount"/>'+
                    '</div>'+
                    '<a href="javascript:void (0)" class="jian">-</a>'+
                '</div>'
            )
        });
        //删除新增
        $(document).on('click','.jian',function(){$(this).parent().remove();});


        //关闭选择商户
        $('.xuanZe_gb').click(function(){$('.xuanZe').fadeOut(200);});
        //打开商户选择
        var dpm = null;
        $(document).on('click','.search',function(){
            dpm = $(this).parent().find('.store-name');
			dpm.addClass('suoding');
            var dpm_val = dpm.val();
			//update cynthia 数据传入	
             var data= [
                { "gndname":"CC SHOP1" , "gndcode":"F267" },
                { "gndname":"CC SHOP2" , "gndcode":"F268" },
                { "gndname":"CC SHOP3" , "gndcode":"F269" },
                ];  
				$('.xuanZe .hangHu').html('');
				$('.xuanZe').fadeIn(200);
				var html = '';
				for(i=0;i<data.length;i++){
					html += "<div  class='soudingname'><div><p>"+data[i].gndname+"</p><p><b>"+data[i].gndcode+"</b></p></div></div> ";
				}
				$('.xuanZe .hangHu').append(html);									
		/*	$.ajax({
				type:'post',
				url:'../home/store-info',
				data:{fname:dpm_val},
				success:function(ret){
					if(ret.status==1){
						$('.xuanZe .hangHu').html('');
						$('.xuanZe').fadeIn(200);
						var html = '';
						for(i=0;i<ret.data.length;i++){
							html += "<div  class='soudingname'><div><p>"+ret.data[i].gndname+"</p><p><b>"+ret.data[i].gndcode+"</b></p></div></div> ";
						}
						$('.xuanZe .hangHu').append(html);
					}else{
						layer.msg(ret.message, {
                          time: 2000, 
                        });
					}
					
				}
			});*/
        });
        //选择商户
		$(document).on('click','.soudingname',function(){
            $('.xuanZe').fadeOut(200);
            dpm.val($(this).find('p:eq(0)').html());
			dpm.next('input:eq(0)').val($(this).find('p:eq(1)').find('b').html());
        })
        // $('.suoding').click(function(){alert('aaa');
            // $('.xuanZe').fadeOut(200);
            // dpm.val($(this).find('p:eq(0)').html());
        // })
		
		$(document).on('blur','.amount',function(){
			var val = $(this).val();
			var reg = /^([1-9][\d]{0,7}|0)(\.[\d]{1,2})?$/;
			if(!reg.test(val)){
				layer.msg('请正确填写金额！', {
						  time: 2000, //2s后自动关闭
						});
			}
		});
		
		//下一页
		$('.xy').on('click',function(){
			var reg = /^([1-9][\d]{0,7}|0)(\.[\d]{1,2})?$/;
			var name = '';amoun = ''; num = '';code = '';
			if($("input.store-name").length==1){

                if($(this).hasClass('tiaozhuang') && (!$("input.store-name")[0].value || !$("input.serial-num")[0].value  || !$("input.amount")[0].value)){
                    location.href = "../home/exchange";
                    return false;
                }
                if(!$("input.store-name")[0].value && !$("input.serial-num")[0].value  && !$("input.amount")[0].value){
                    layer.msg('你今日还没有消费记录，请填写消费记录！', {
                      time: 2000, //2s后自动关闭
                    });
                    return false;
                }
            }

			for(i=0;i<$("input.store-name").length;i++){
				if(!$("input.store-name")[i].value){
					layer.msg('店铺名称不能为空！', {
							  time: 2000, //2s后自动关闭
							});
					return false;
				}
				if(!$("input.serial-num")[i].value){
					layer.msg('流水号不能为空！', {
							  time: 2000, //2s后自动关闭
							});
					return false;
				}
				if(!$("input.amount")[i].value){
					layer.msg('消费金额不能为空！', {
							  time: 2000, //2s后自动关闭
							});
					return false;
				}
				if(!reg.test($("input.amount")[i].value)){
					layer.msg('请正确填写金额！', {
							  time: 2000, //2s后自动关闭
							});
					return false;
				}
				name += '; '+$("input.store-name")[i].value+' ';
				amoun += '; '+$("input.amount")[i].value+' ';
				num += '; '+$("input.serial-num")[i].value+' ';
				code += '; '+$("input.store-code")[i].value+' ';
			}
			var storename = name.substr(1).split(';');
			var amount = amoun.substr(1).split(';');
			var serialnum = num.substr(1).split(';');
			var storecode = code.substr(1).split(';');
            //update cynthia 下一页转向
            location.href = "exchange.html"
			/*$.ajax({
				type:'post',
				url:'../home/add-consumer',
				data:{storename:storename,amount:amount,serialnum:serialnum,storecode:storecode},
				success:function(ret){
					if(ret.status==2){
						location.href = "../home/search.html";
					}
					if(ret.status==1){
						layer.msg(ret.message, {
                          time: 2000, //2s后自动关闭
                        });
						location.href = "../home/exchange.html";
					}else{
						layer.msg(ret.message, {
                          time: 2000, //2s后自动关闭
                        });
					}
					
				}
			});*/
		});
    }
</script>
</html>
